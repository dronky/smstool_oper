/* REXX */
/* PROCEDURE WHICH CHECKS IS VOLUME QUIESCED ON CURRENT SYSTEM */
CALL ISPPRXVP 'I'
STAT = 'NOT FOUND'
CMPVOL=''
ADDR=''
/* DEFINING ACTIVE SYSTEMS */
IF SUBSTR(MVSVAR(SYSNAME),1,2)='EP' THEN
  SYSTEMS=3
ELSE
  IF SUBSTR(MVSVAR(SYSNAME),1,2)='ED' THEN
    SYSTEMS=2
  ELSE
    IF SUBSTR(MVSVAR(SYSNAME),1,2)='SY' THEN
      SYSTEMS=8
COMMAND = 'D SMS,VOLUME('VOL')'
IF ISFCALLS('ON') <> 0 THEN EXIT 99
ADDRESS SDSF "ISFEXEC '/"COMMAND"' (WAIT"
/* SPLIT SYS QSC STATUS STRING INTO STEMS */
ISFULOG.6=SUBSTR(ISFULOG.6,69,31)
DO I = 1 BY 1 WHILE ISFULOG.6 <> ''
    PARSE VAR ISFULOG.6 Y.I ' ' ISFULOG.6
END
Y.0 = I-1
K=0
DO I=1 TO Y.0
IF Y.I='Q' THEN K=K+1
END
IF K=SYSTEMS THEN
DO
  SAY 'CHECKING COMPLETE. QUIESCED ON ALL SYSTEMS'
  STAT='OK'
END
ELSE
  SAY 'CHECK FAILED. QUIESCED ONLY ON' K'/'SYSTEMS' SYSTEMS'
CALL ISFCALLS 'OFF'
CALL ISPPRXVP 'T'
EXIT 0
